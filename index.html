<script>
// META MASK BAĞLANTI KODU (MOBİL İMZA DESTEKLİ)
async function connectWallet() {
  const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  
  if (isMobile) {
    try {
      // 1. META MASK UYGULAMASINI AÇ
      window.location.href = "metamask://";
      
      // 2. 1 SANİYE BEKLE (Uygulamanın açılması için)
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // 3. CÜZDAN BAĞLANTISI KUR
      const accounts = await window.ethereum.request({ 
        method: 'eth_requestAccounts' 
      });
      userAddress = accounts[0];
      
      // 4. MOBİL İMZA İSTEĞİ (EKSTRA GÜVENLİK)
      const message = `FreeDogeAI Bağlantı Onayı\n\nAdres: ${userAddress}\nZaman: ${new Date().toLocaleString()}`;
      const signature = await window.ethereum.request({
        method: 'personal_sign',
        params: [message, userAddress]
      });
      
      // 5. BSC AĞINA GEÇ
      await switchToBSC();
      
      // 6. UI GÜNCELLE
      updateWalletUI();
      
    } catch (error) {
      console.error("Mobile connection failed:", error);
      alert("Bağlantı hatası: " + (error.message || "Lütfen MetaMask uygulamasında imzayı onaylayın"));
    }
    
  } else {
    // DESKTOP BAĞLANTISI
    if (window.ethereum) {
      try {
        const accounts = await window.ethereum.request({ 
          method: 'eth_requestAccounts' 
        });
        userAddress = accounts[0];
        updateWalletUI();
      } catch (error) {
        console.error("Desktop connection error:", error);
      }
    }
  }
}

// BSC AĞINA GEÇİŞ
async function switchToBSC() {
  try {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: '0x38' }] // BSC Mainnet
    });
  } catch (error) {
    console.error("Network switch failed:", error);
  }
}

// TOKEN GÖRÜNTÜLEME
async function addFDAToken() {
  try {
    await window.ethereum.request({
      method: 'wallet_watchAsset',
      params: {
        type: 'ERC20',
        options: {
          address: '0x8161698A74F2ea0035B9912ED60140893Ac0f39C',
          symbol: 'FDAI',
          decimals: 18,
          image: 'https://freedogeai.github.io/FreeDogeAI-Forge/logo.png'
        }
      }
    });
  } catch (error) {
    console.error("Token ekleme hatası:", error);
  }
}
</script>
