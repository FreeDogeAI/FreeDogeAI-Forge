<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token Presale</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f1f1f1;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    button {
      background: #f6851b;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 0;
      transition: background 0.3s;
    }
    button:hover {
      background: #e2761b;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin-top: 20px;
      color: #666;
      font-weight: bold;
    }
    #userAddress {
      word-break: break-all;
      margin: 10px 0;
      color: #2b6cb0;
    }
    input {
      padding: 10px;
      width: 100%;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>TOKEN PRESALE</h1>
    <p>Connect your wallet to participate in the presale.</p>
    
    <button id="connectWalletBtn">Connect MetaMask</button>
    <div id="userAddress"></div>
    
    <div id="presaleSection" style="display: none;">
      <h3>Send BNB to participate</h3>
      <p>Presale Rate: 1 BNB = 1000 Tokens</p>
      <input type="number" id="bnbAmount" placeholder="Enter BNB amount" min="0.01" step="0.01">
      <button id="buyTokensBtn">Buy Tokens</button>
    </div>
    
    <div id="status"></div>
  </div>

  <!-- Web3 ve Ethers.js kütüphaneleri -->
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <script>
    // Ayarlar
    const PRESALE_WALLET = "0xd924e01c7d319c5B23708Cd622bD1143CD4Fb360"; // BNB'lerin gideceği adres
    const TOKEN_CONTRACT = "0x8161698A74F2ea0035B9912ED60140893Ac0f39C"; // Token kontrat adresi
    const CHAIN_ID = 56; // BSC Mainnet (Testnet için 97 kullanın)

    // DOM Elementleri
    const connectWalletBtn = document.getElementById("connectWalletBtn");
    const buyTokensBtn = document.getElementById("buyTokensBtn");
    const userAddressDiv = document.getElementById("userAddress");
    const presaleSection = document.getElementById("presaleSection");
    const statusDiv = document.getElementById("status");
    const bnbAmountInput = document.getElementById("bnbAmount");

    let provider;
    let signer;
    let userAddress;

    // MetaMask Bağlantısı
    connectWalletBtn.addEventListener("click", async () => {
      try {
        if (window.ethereum) {
          // MetaMask bağlantısını iste
          await window.ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          userAddress = await signer.getAddress();

          // Ağ kontrolü
          const network = await provider.getNetwork();
          if (network.chainId !== CHAIN_ID) {
            statusDiv.textContent = `❌ Please switch to ${CHAIN_ID === 56 ? "BSC Mainnet" : "BSC Testnet"}`;
            return;
          }

          // UI Güncelleme
          userAddressDiv.textContent = `Connected: ${userAddress}`;
          presaleSection.style.display = "block";
          connectWalletBtn.disabled = true;
          statusDiv.textContent = "✅ Wallet connected!";
        } else {
          statusDiv.textContent = "❌ MetaMask not installed!";
        }
      } catch (error) {
        statusDiv.textContent = `❌ Error: ${error.message}`;
      }
    });

    // Token Satın Alma
    buyTokensBtn.addEventListener("click", async () => {
      const bnbAmount = bnbAmountInput.value;
      if (!bnbAmount || isNaN(bnbAmount) || parseFloat(bnbAmount) <= 0) {
        statusDiv.textContent = "❌ Please enter a valid BNB amount";
        return;
      }

      try {
        // BNB Gönderim İşlemi
        const tx = await signer.sendTransaction({
          to: PRESALE_WALLET,
          value: ethers.utils.parseEther(bnbAmount),
        });

        statusDiv.textContent = `⏳ Transaction sent: ${tx.hash}`;
        
        // Transaction onayını bekle
        await tx.wait();
        statusDiv.textContent = `✅ Transaction confirmed! Tokens will be sent to your address.`;
        
      } catch (error) {
        statusDiv.textContent = `❌ Error: ${error.message}`;
      }
    });

    // Ağ Değişikliğini Dinle
    if (window.ethereum) {
      window.ethereum.on("chainChanged", () => window.location.reload());
      window.ethereum.on("accountsChanged", () => window.location.reload());
    }
  </script>
</body>
</html>
