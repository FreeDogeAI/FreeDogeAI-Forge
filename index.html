<!DOCTYPE html>
<html>
<head>
    <title>MetaMask Bağlantısı</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <button id="connectBtn">MetaMask ile Bağlan</button>
    <p id="status">Durum: Bağlantı bekleniyor...</p>

    <script>
        // HTML Elementlerini Seç
        const connectBtn = document.getElementById('connectBtn');
        const statusEl = document.getElementById('status');

        // MetaMask Bağlantı Fonksiyonu
        async function connectToMetaMask() {
            statusEl.textContent = "MetaMask bağlantısı kuruluyor...";

            // MetaMask Uzantısı Kontrolü (Masaüstü)
            if (window.ethereum && window.ethereum.isMetaMask) {
                try {
                    // Cüzdan Adresini İste
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    onSuccess(accounts[0]); // Başarılı bağlantı
                } catch (error) {
                    onError(error); // Hata durumu
                }
            } 
            // Mobil Cihaz Kontrolü
            else if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                // MetaMask Deep Link'i Oluştur
                const dappUrl = encodeURIComponent(window.location.href);
                const metamaskAppLink = `https://metamask.app.link/dapp/${dappUrl}`;
                
                // Mobil Uygulamayı Aç
                window.location.href = metamaskAppLink;
                
                // Mobilde İşlem Tamamlandığında Dinle
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'METAMASK_CONNECTED') {
                        onSuccess(event.data.address);
                    }
                });
            } 
            // MetaMask Bulunamadı
            else {
                statusEl.textContent = "Lütfen MetaMask kurun!";
            }
        }

        // Başarılı Bağlantı
        async function onSuccess(walletAddress) {
            statusEl.textContent = `Bağlı Cüzdan: ${walletAddress}`;
            
            // İmza İste (Örnek Mesaj)
            try {
                const message = "Bu işlemi onaylayın: #" + Date.now();
                const signature = await window.ethereum.request({
                    method: 'personal_sign',
                    params: [message, walletAddress]
                });
                
                statusEl.innerHTML += `<br>İmza: <code>${signature.slice(0, 20)}...</code>`;
            } catch (error) {
                onError(error);
            }
        }

        // Hata Yönetimi
        function onError(error) {
            statusEl.textContent = `Hata: ${error.message || "Kullanıcı reddetti!"}`;
        }

        // Butona Tıklanınca Tetikle
        connectBtn.addEventListener('click', connectToMetaMask);
    </script>
</body>
</html>
