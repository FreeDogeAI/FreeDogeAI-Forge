<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeDogeAI Presale</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        /* CSS kodlarÄ± aynÄ± kaldÄ±, deÄŸiÅŸiklik yapÄ±lmadÄ± */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            margin: 0;
            padding: 20px;
            color: #FFD700;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #000000;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo-container img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
        }
        button {
            background: #25D366;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #1DA851;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .wallet-info {
            background-color: #000000;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-word;
            font-family: monospace;
            border: 1px solid #FFD700;
            color: #FFD700;
        }
        .info-box {
            background-color: #000000;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #FFD700;
            color: #FFD700;
            margin-top: 20px;
        }
        h1, h3, p, label {
            color: #FFD700;
        }
        .calculation-result {
            margin: 15px 0;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="logo.png" alt="FreeDogeAI Logo">
        </div>
        <h1>FreeDogeAI Presale</h1>
        <p>1 BNB = 120,000,000,000 FDAI</p>
        <button id="connectWalletBtn">ðŸ”— Connect with MetaMask</button>

        <div id="walletInfo" style="display: none;">
            <h3>Your Wallet</h3>
            <div class="wallet-info">
                <p><strong>Address:</strong> <span id="walletAddress"></span></p>
                <p><strong>BNB Balance:</strong> <span id="bnbBalance"></span></p>
            </div>
        </div>
        
        <div>
            <label for="bnbAmount"><strong>BNB Amount:</strong></label>
            <input type="number" id="bnbAmount" placeholder="0.1" step="0.01" min="0.01">
            
            <div class="calculation-result">
                <strong>You will receive:</strong> <span id="fdaiAmount">0</span> FDAI
            </div>
            
            <button id="buyBtn" disabled>ðŸš€ Buy FDAI Tokens</button>
        </div>
        
        <div class="info-box">
            <h3>Important Information</h3>
            <p>After your token purchase, your tokens will be reflected in your wallet within 24 hours. To view your token balance, you may need to manually add the token contract address using the 'Add Token' option in MetaMask.</p>
            
            <p><strong>FDAI Recipient Address:</strong> <span id="userTokenAddress"></span></p>
            
            <p><strong>NOTE:</strong> If FDAI tokens do not appear in your wallet after purchase, you can manually add the token using the following contract address:</p>
            <div class="wallet-info" style="background-color: #000000; border: 2px dashed #FFD700; color: #00FFCC; font-weight: bold; font-size: 16px; padding: 15px; border-radius: 10px; text-align: center;">
                0x8161698A74F2ea0035B9912ED60140893Ac0f39C
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            RECEIVE_WALLET: "0xd924e01c7d319c5b23708cd622bd1143cd4fb360",
            TOKENS_PER_BNB: 120000000000,
            BSC_CHAIN_ID: 56
        };

        // App state
        let web3;
        let userAddress = "";
        let isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            checkReturnFromMobile();
        });

        function setupEventListeners() {
            document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
            document.getElementById('buyBtn').addEventListener('click', sendBNB);
            document.getElementById('bnbAmount').addEventListener('input', calculateFDAI);
        }

        // Check if returning from mobile MetaMask
        function checkReturnFromMobile() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mobileSign') === 'true' && window.ethereum?.selectedAddress) {
                completeMobileConnection();
            }
        }

        // Wallet connection handler
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    if (isMobile) {
                        // Mobile cihazlarda MetaMask yÃ¼klÃ¼ deÄŸilse direkt uygulamaya yÃ¶nlendir
                        window.location.href = "https://metamask.app.link/dapp/" + encodeURIComponent(window.location.href.split('?')[0] + '?mobileSign=true');
                        return;
                    }
                    throw new Error("MetaMask not installed");
                }

                if (isMobile) {
                    await handleMobileConnection();
                } else {
                    await handleDesktopConnection();
                }
            } catch (error) {
                console.error("Connection error:", error);
                alert("Connection failed: " + error.message);
            }
        }

        // Mobile connection flow
        async function handleMobileConnection() {
            // MetaMask uygulamasÄ±nÄ± aÃ§
            window.location.href = "metamask://";
            
            // KÄ±sa bir sÃ¼re bekleyip baÄŸlantÄ±yÄ± baÅŸlat
            setTimeout(async () => {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                web3 = new Web3(window.ethereum);
                
                // Ä°mza iste
                const message = `Welcome to FreeDogeAI!\n\nPlease sign to connect your wallet.\n\nAddress: ${userAddress}`;
                await window.ethereum.request({
                    method: 'personal_sign',
                    params: [message, userAddress]
                });
                
                // AÄŸ kontrolÃ¼
                await switchToBSC();
                
                // UI gÃ¼ncelle
                updateWalletUI();
                
                // 2 saniye sonra siteye geri dÃ¶n
                setTimeout(() => {
                    window.location.href = window.location.href.split('?')[0] + '?mobileSign=true';
                }, 2000);
            }, 1000);
        }

        // Desktop connection flow
        async function handleDesktopConnection() {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            web3 = new Web3(window.ethereum);
            
            // Ä°mza iste
            const message = `Welcome to FreeDogeAI!\n\nPlease sign to connect your wallet.\n\nAddress: ${userAddress}`;
            await window.ethereum.request({
                method: 'personal_sign',
                params: [message, userAddress]
            });
            
            // AÄŸ kontrolÃ¼
            await switchToBSC();
            
            // UI gÃ¼ncelle
            updateWalletUI();
        }

        // Complete mobile connection after return
        async function completeMobileConnection() {
            userAddress = window.ethereum.selectedAddress;
            web3 = new Web3(window.ethereum);
            await switchToBSC();
            updateWalletUI();
            
            // URL'yi temizle
            window.history.replaceState({}, document.title, window.location.pathname);
        }

        // Switch to BSC network
        async function switchToBSC() {
            try {
                const chainId = await web3.eth.getChainId();
                if (chainId !== CONFIG.BSC_CHAIN_ID) {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x38' }]
                    });
                }
            } catch (error) {
                console.error("Network switch failed:", error);
            }
        }

        // Update UI after connection
        function updateWalletUI() {
            const shortAddress = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
            document.getElementById('walletAddress').textContent = shortAddress;
            document.getElementById('userTokenAddress').textContent = shortAddress;
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('connectWalletBtn').textContent = 'âœ… Connected';
            document.getElementById('buyBtn').disabled = false;

            // BNB balance gÃ¼ncelle
            web3.eth.getBalance(userAddress).then(balance => {
                const bnbBalance = web3.utils.fromWei(balance, 'ether');
                document.getElementById('bnbBalance').textContent = `${parseFloat(bnbBalance).toFixed(6)} BNB`;
            }).catch(console.error);
        }

        // Calculate FDAI tokens
        function calculateFDAI() {
            const amount = parseFloat(document.getElementById('bnbAmount').value) || 0;
            document.getElementById('fdaiAmount').textContent = (amount * CONFIG.TOKENS_PER_BNB).toLocaleString();
        }

        // Send BNB transaction
        async function sendBNB() {
            const bnbAmount = parseFloat(document.getElementById('bnbAmount').value);
            if (!bnbAmount || bnbAmount <= 0) {
                alert("Please enter a valid amount!");
                return;
            }

            try {
                const weiAmount = web3.utils.toWei(bnbAmount.toString(), 'ether');
                const tx = {
                    from: userAddress,
                    to: CONFIG.RECEIVE_WALLET,
                    value: weiAmount,
                    gas: 300000,
                    gasPrice: await web3.eth.getGasPrice()
                };

                const receipt = await web3.eth.sendTransaction(tx);
                alert(`âœ… ${bnbAmount} BNB successfully sent!\n\nYou will receive: ${(bnbAmount * CONFIG.TOKENS_PER_BNB).toLocaleString()} FDAI\nTX Hash: ${receipt.transactionHash}`);
            } catch (error) {
                alert("Transaction failed: " + (error.message || error));
            }
        }

        // Handle account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    userAddress = accounts[0];
                    web3 = new Web3(window.ethereum);
                    updateWalletUI();
                } else {
                    disconnectWallet();
                }
            });

            window.ethereum.on('chainChanged', () => {
                window.location.reload();
            });
        }

        function disconnectWallet() {
            document.getElementById('walletInfo').style.display = 'none';
            document.getElementById('connectWalletBtn').textContent = 'ðŸ”— Connect with MetaMask';
            document.getElementById('buyBtn').disabled = true;
            userAddress = "";
            web3 = null;
        }
    </script>
</body>
</html>
