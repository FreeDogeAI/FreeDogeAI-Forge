<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeDogeAI Forge - Smart Contract IDE</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            background-color: #1a252f;
            color: #fff;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        .sidebar {
            width: 250px;
            background-color: #2b3a47;
            padding: 10px;
            border-right: 1px solid #444;
        }
        .sidebar h3 {
            margin: 0 0 10px;
            font-size: 18px;
        }
        .file-explorer ul {
            list-style: none;
            padding: 0;
        }
        .file-explorer li {
            padding: 5px;
            cursor: pointer;
        }
        .file-explorer li:hover {
            background-color: #3a4b5a;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .editor {
            flex: 1;
            padding: 10px;
        }
        .editor textarea {
            width: 100%;
            height: 100%;
            background-color: #2b3a47;
            color: #fff;
            border: none;
            resize: none;
            font-family: 'Courier New', Courier, monospace;
        }
        .controls {
            background-color: #2b3a47;
            padding: 10px;
            border-top: 1px solid #444;
        }
        .controls button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            margin-right: 10px;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .output {
            background-color: #2b3a47;
            padding: 10px;
            border-top: 1px solid #444;
            height: 150px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar: Dosya Gezgini -->
        <div class="sidebar">
            <h3>File Explorer</h3>
            <div>
                <button onclick="newFile()">New File</button>
            </div>
            <div class="file-explorer">
                <ul id="fileList">
                    <!-- Dosyalar dinamik olarak eklenecek -->
                </ul>
            </div>
        </div>

        <!-- Ana İçerik: Kod Editörü ve Kontroller -->
        <div class="main-content">
            <div class="editor">
                <textarea id="codeEditor" rows="20" cols="80"></textarea>
            </div>
            <div class="controls">
                <button onclick="compileCode()">Compile</button>
                <button onclick="deployContract()">Deploy</button>
            </div>
            <div class="output" id="output">
                Output will appear here...
            </div>
        </div>
    </div>

    <!-- Gerekli Kütüphaneler -->
    <script src="https://cdn.jsdelivr.net/npm/solc@0.8.17/solc.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
    <script>
        let currentFile = null;
        let files = JSON.parse(localStorage.getItem('files')) || {
            'FDAIPresale.sol': `pragma solidity ^0.8.17;

// SPDX-License-Identifier: Unlicense
contract FDAIPresale {
    address public owner;
    IERC20 public token;
    address public receiverWallet;
    bool public saleActive = true;
    uint256 public rate = 459900;
    
    event TokensPurchased(address buyer, uint256 amount);
    event SaleClosed();
    
    modifier onlyOwner() {
        require(msg.sender == owner, "Not owner");
        _;
    }
}`
        };
        let web3;
        let compiledContract = null;

        // Dosya Listesini Güncelle
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            Object.keys(files).forEach(fileName => {
                const li = document.createElement('li');
                li.innerText = fileName;
                li.onclick = () => loadFile(fileName);
                fileList.appendChild(li);
            });
            localStorage.setItem('files', JSON.stringify(files));
        }

        // Yeni Dosya Oluştur
        function newFile() {
            const fileName = prompt('Enter file name (e.g., Contract.sol):');
            if (fileName && !files[fileName]) {
                files[fileName] = `pragma solidity ^0.8.17;\n\ncontract ${fileName.replace('.sol', '')} {\n\n}`;
                updateFileList();
                loadFile(fileName);
            } else if (files[fileName]) {
                alert('File already exists!');
            }
        }

        // Dosya Yükle
        function loadFile(fileName) {
            currentFile = fileName;
            document.getElementById('codeEditor').value = files[fileName];
            document.getElementById('output').innerText = `Loaded file: ${fileName}`;
        }

        // Solidity Kodunu Derle
        async function compileCode() {
            const code = document.getElementById('codeEditor').value;
            files[currentFile] = code; // Dosyayı güncelle
            localStorage.setItem('files', JSON.stringify(files));
            const output = document.getElementById('output');

            try {
                const compiled = solc.compile(JSON.stringify({
                    language: "Solidity",
                    sources: {
                        [currentFile]: {
                            content: code
                        }
                    },
                    settings: {
                        outputSelection: {
                            "*": {
                                "*": ["abi", "evm.bytecode"]
                            }
                        }
                    }
                }));
                const result = JSON.parse(compiled);

                if (result.errors) {
                    output.innerText = 'Compilation Errors:\n' + result.errors.map(err => err.formattedMessage).join('\n');
                    compiledContract = null;
                } else {
                    const contractName = Object.keys(result.contracts[currentFile])[0];
                    compiledContract = {
                        abi: result.contracts[currentFile][contractName].abi,
                        bytecode: result.contracts[currentFile][contractName].evm.bytecode.object
                    };
                    output.innerText = 'Compilation Successful!\nABI and Bytecode generated.';
                }
            } catch (error) {
                output.innerText = 'Error during compilation: ' + error.message;
                compiledContract = null;
            }
        }

        // Web3 ile Ethereum Ağına Bağlan ve Kontratı Dağıt
        async function deployContract() {
            const output = document.getElementById('output');
            if (!compiledContract) {
                output.innerText = 'Please compile the contract first!';
                return;
            }

            // Web3 ile MetaMask'e bağlan
            if (typeof window.ethereum === 'undefined') {
                output.innerText = 'MetaMask is not installed!';
                return;
            }

            try {
                // MetaMask ile bağlantı kur
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                web3 = new Web3(window.ethereum);

                const accounts = await web3.eth.getAccounts();
                const account = accounts[0];

                output.innerText = `Connected with account: ${account}\nDeploying contract...`;

                // Kontratı dağıt
                const contract = new web3.eth.Contract(compiledContract.abi);
                const deployTx = contract.deploy({
                    data: '0x' + compiledContract.bytecode
                });

                const gas = await deployTx.estimateGas({ from: account });
                const deployedContract = await deployTx.send({
                    from: account,
                    gas: gas,
                    gasPrice: await web3.eth.getGasPrice()
                });

                output.innerText += `\nContract deployed at address: ${deployedContract.options.address}`;
            } catch (error) {
                output.innerText = 'Error during deployment: ' + error.message;
            }
        }

        // Sayfa Yüklendiğinde Dosya Listesini Güncelle
        window.onload = () => {
            updateFileList();
            if (Object.keys(files).length > 0) {
                loadFile(Object.keys(files)[0]);
            }
        };
    </script>
</body>
</html>
